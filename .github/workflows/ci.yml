name: CI Pipeline
on:
â€¯ push:
â€¯ â€¯ branches: ["main"]
â€¯ pull_request:
â€¯ â€¯ branches: ["main"]
jobs:
â€¯ tests:
â€¯ â€¯ name: ğŸ§ª Unit Tests
â€¯ â€¯ runs-on: ubuntu-latest
â€¯ â€¯ steps:
â€¯ â€¯ â€¯ - uses: actions/checkout@v4
â€¯ â€¯ â€¯ - name: Setup Python
â€¯ â€¯ â€¯ â€¯ uses: actions/setup-python@v6
â€¯ â€¯ â€¯ â€¯ with:
â€¯ â€¯ â€¯ â€¯ â€¯ python-version: "3.11"
â€¯ â€¯ â€¯ - name: Install dependencies
â€¯ â€¯ â€¯ â€¯ run: pip install -r requirements.txt
â€¯ â€¯ â€¯ - name: Run tests
â€¯ â€¯ â€¯ â€¯ run: python app_test.py
â€¯ build:
â€¯ â€¯ name: ğŸ³ Docker Build
â€¯ â€¯ needs: tests
â€¯ â€¯ runs-on: ubuntu-latest
â€¯ â€¯ steps:
â€¯ â€¯ â€¯ - uses: actions/checkout@v4
â€¯ â€¯ â€¯ - name: Build Docker image
â€¯ â€¯ â€¯ â€¯ run: docker build -t api:${{ github.sha }} .
â€¯ security-scan:
â€¯ â€¯ name: ğŸ” Security Scan
â€¯ â€¯ needs: build
â€¯ â€¯ runs-on: ubuntu-latest
â€¯ â€¯ steps:
â€¯ â€¯ â€¯ - name: Install Grype
â€¯ â€¯ â€¯ â€¯ run: |
â€¯ â€¯ â€¯ â€¯ â€¯ curl -sSfL https://raw.githubusercontent.com/anchore/grype/main/install.sh \
â€¯ â€¯ â€¯ â€¯ â€¯ | sh -s -- -b /usr/local/bin
â€¯ â€¯ â€¯ - name: Scan Docker image
â€¯ â€¯ â€¯ â€¯ run: |
â€¯ â€¯ â€¯ â€¯ â€¯ grype api:${{ github.sha }} --fail-on critical
